# âš¡ ì„±ëŠ¥ í…ŒìŠ¤íŠ¸ ë° ìµœì í™”

> Flow ëŒ€ê¸°ì—´ ì‹œìŠ¤í…œì˜ ì„±ëŠ¥ í…ŒìŠ¤íŠ¸ ê²°ê³¼ ë° ìµœì í™” ê³¼ì •

---

## ğŸ“‘ ëª©ì°¨

1. [í…ŒìŠ¤íŠ¸ í™˜ê²½](#-í…ŒìŠ¤íŠ¸-í™˜ê²½)
2. [ë¶€í•˜ í…ŒìŠ¤íŠ¸ ê²°ê³¼](#-ë¶€í•˜-í…ŒìŠ¤íŠ¸-ê²°ê³¼)
3. [ì„±ëŠ¥ ìµœì í™” ê³¼ì •](#-ì„±ëŠ¥-ìµœì í™”-ê³¼ì •)
4. [ë³‘ëª© ì§€ì  ë¶„ì„](#-ë³‘ëª©-ì§€ì -ë¶„ì„)
5. [í™•ì¥ì„± í…ŒìŠ¤íŠ¸](#-í™•ì¥ì„±-í…ŒìŠ¤íŠ¸)
6. [ê¶Œì¥ ì‚¬í•­](#-ê¶Œì¥-ì‚¬í•­)

---

## ğŸ–¥ï¸ í…ŒìŠ¤íŠ¸ í™˜ê²½

### í•˜ë“œì›¨ì–´ ì‚¬ì–‘

```yaml
ì• í”Œë¦¬ì¼€ì´ì…˜ ì„œë²„:
  CPU: Apple M1 (8 cores)
  RAM: 16GB
  OS: macOS 14

Redis:
  Version: 7.0.15
  Mode: Standalone
  Memory: 512MB allocated
  Persistence: AOF disabled (í…ŒìŠ¤íŠ¸ìš©)
```

### ì†Œí”„íŠ¸ì›¨ì–´ ìŠ¤íƒ

```yaml
Application:
  - Java: 21
  - Spring Boot: 3.4.4
  - Spring WebFlux: Reactive
  - Redis Client: Lettuce (Reactive)

Test Tools:
  - JMeter: 5.6.3
  - curl: 8.4.0
  - redis-benchmark: 7.0.15
```

### í…ŒìŠ¤íŠ¸ ì„¤ì •

```yaml
JMeter ì„¤ì •:
  Thread Group:
    Number of Threads: 30 (ë™ì‹œ ì‚¬ìš©ì)
    Ramp-Up Period: 10ì´ˆ (ì ì§„ì  ì¦ê°€)
    Loop Count: 1 (ê° ì‚¬ìš©ì 1íšŒ ìš”ì²­)
    
  HTTP Request:
    Server: localhost
    Port: 9010
    Method: POST
    Path: /api/v1/queue
    Parameters: user_id=${__Random(1,10000)}&queue=default
```

---

## ğŸ“Š ë¶€í•˜ í…ŒìŠ¤íŠ¸ ê²°ê³¼

### 1. ëŒ€ê¸°ì—´ ë“±ë¡ API

**í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤**: 30ëª…ì´ 10ì´ˆ ë™ì•ˆ ìˆœì°¨ì ìœ¼ë¡œ ëŒ€ê¸°ì—´ì— ë“±ë¡

#### JMeter ë¶€í•˜ í…ŒìŠ¤íŠ¸ ê²°ê³¼

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            ëŒ€ê¸°ì—´ ë“±ë¡ ì„±ëŠ¥ í…ŒìŠ¤íŠ¸ ê²°ê³¼                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Label              â”‚ Samples â”‚ Average â”‚ Min â”‚ Max  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¤
â”‚ ëŒ€ê¸°ì—´ ë“±ë¡         â”‚   30    â”‚  52ms   â”‚ 12msâ”‚ 198msâ”‚
â”‚ ìˆœìœ„ ì¡°íšŒ          â”‚   30    â”‚  28ms   â”‚  8msâ”‚  87msâ”‚
â”‚ í†µê³„ ì¡°íšŒ          â”‚   30    â”‚  15ms   â”‚  5msâ”‚  45msâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”˜

ì „ì²´ í†µê³„:
â”œâ”€ ì´ ìš”ì²­ ìˆ˜:        90ê°œ (30ê°œ Ã— 3 API)
â”œâ”€ ì„±ê³µ:             90ê°œ (100%)
â”œâ”€ ì‹¤íŒ¨:             0ê°œ (0%)
â”œâ”€ í‰ê·  ì‘ë‹µ ì‹œê°„:    31.67ms
â”œâ”€ 95 Percentile:    150ms
â”œâ”€ 99 Percentile:    190ms
â””â”€ ì²˜ë¦¬ëŸ‰ (TPS):     9 req/s
```

#### Response Times Over Time

```
ì‘ë‹µ ì‹œê°„ (ms)
200 â”‚                                              â—
180 â”‚                                         
160 â”‚                                    â—
140 â”‚                               â—        
120 â”‚                          â—              
100 â”‚                     â—                   
 80 â”‚                â—                        
 60 â”‚           â—         â—    â—    â—    â—    â—
 40 â”‚      â—                                   
 20 â”‚ â—                                        
  0 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    0s   2s   4s   6s   8s  10s  12s  14s  16s
```

**ë¶„ì„**:
- ì´ˆë°˜ì—ëŠ” ì‘ë‹µ ì‹œê°„ì´ ë¹ ë¦„ (12ms)
- ì¤‘ë°˜ ì´í›„ Redis ì—°ê²° í’€ ì›Œë°ì—…ìœ¼ë¡œ ì•ˆì •í™” (40-60ms)
- ìµœëŒ€ ì‘ë‹µ ì‹œê°„ë„ 200ms ì´í•˜ë¡œ ì–‘í˜¸

---

### 2. ìˆœìœ„ ì¡°íšŒ API

**í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤**: 1,000ëª…ì´ ë“±ë¡ëœ ìƒíƒœì—ì„œ ìˆœìœ„ ì¡°íšŒ

```bash
# 1,000ëª… ë“±ë¡
for i in {1..1000}; do
  curl -X POST "localhost:9010/api/v1/queue?user_id=$i" &
done
wait

# ìˆœìœ„ ì¡°íšŒ ì„±ëŠ¥ ì¸¡ì •
time for i in {1..100}; do
  curl -s "localhost:9010/api/v1/queue/rank?user_id=500" > /dev/null
done
```

**ê²°ê³¼**:
```
100ê°œ ìš”ì²­ ì²˜ë¦¬ ì‹œê°„: 2.5ì´ˆ
í‰ê·  ì‘ë‹µ ì‹œê°„: 25ms
ìµœì†Œ: 15ms
ìµœëŒ€: 42ms
```

**ë¶„ì„**:
- Redis `ZRANK` ëª…ë ¹: O(log N) ë³µì¡ë„
- 1,000ëª… â†’ 10,000ëª…ìœ¼ë¡œ ì¦ê°€í•´ë„ ì‘ë‹µ ì‹œê°„ ê±°ì˜ ë™ì¼ (27ms)
- í™•ì¥ì„± ìš°ìˆ˜ âœ…

---

### 3. ì§„ì… í—ˆìš© API (ìŠ¤ì¼€ì¤„ëŸ¬)

**í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤**: 1,000ëª… ëŒ€ê¸° ìƒíƒœì—ì„œ ìŠ¤ì¼€ì¤„ëŸ¬ë¡œ 3ëª…ì”© ì§„ì… í—ˆìš©

```yaml
ì„¤ì •:
  scheduler.enable: true
  scheduler.max-allow-user-count: 3
  scheduler.fixedDelay: 3000ms

ì¸¡ì • í•­ëª©:
  - 1íšŒ ìŠ¤ì¼€ì¤„ ì‹¤í–‰ ì‹œê°„
  - 1,000ëª… ëª¨ë‘ ì§„ì…í•˜ëŠ” ë° ê±¸ë¦° ì‹œê°„
```

**ê²°ê³¼**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚       ìŠ¤ì¼€ì¤„ëŸ¬ ì„±ëŠ¥ ì¸¡ì • ê²°ê³¼                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1íšŒ ì‹¤í–‰ ì‹œê°„:       85ms                    â”‚
â”‚ ì²˜ë¦¬ ì‚¬ìš©ì ìˆ˜:      3ëª…                     â”‚
â”‚ ì‚¬ìš©ìë‹¹ ì²˜ë¦¬ ì‹œê°„:  28ms                    â”‚
â”‚                                              â”‚
â”‚ 1,000ëª… ì²˜ë¦¬:                                â”‚
â”‚   - ì´ ì‹¤í–‰ íšŸìˆ˜:    334íšŒ (1000 Ã· 3)       â”‚
â”‚   - ì†Œìš” ì‹œê°„:       ì•½ 17ë¶„                 â”‚
â”‚   - ì‹¤ì œ ì²˜ë¦¬ëŸ‰:     ì•½ 1ëª…/ì´ˆ               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ë¶„ì„**:
- 1íšŒ ì‹¤í–‰ë‹¹ 85msë¡œ ë§¤ìš° ë¹ ë¦„ âœ…
- 3ì´ˆ ëŒ€ê¸° + 85ms ì‹¤í–‰ = ì•½ 3.1ì´ˆ ì£¼ê¸°
- ì²˜ë¦¬ ì†ë„ë¥¼ ë†’ì´ë ¤ë©´ `max-allow-user-count` ì¦ê°€ ë˜ëŠ” `fixedDelay` ê°ì†Œ

**ìµœì í™” ì œì•ˆ**:
```yaml
# ì²˜ë¦¬ ì†ë„ 2ë°° í–¥ìƒ
scheduler:
  max-allow-user-count: 6  # 3 â†’ 6
  fixedDelay: 3000  # ìœ ì§€

# ë˜ëŠ”
scheduler:
  max-allow-user-count: 3  # ìœ ì§€
  fixedDelay: 1500  # 3ì´ˆ â†’ 1.5ì´ˆ
```

---

### 4. ëŒ€ê¸°ì‹¤ ì›¹ í˜ì´ì§€ ë¡œë”©

**í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤**: ëŒ€ê¸°ì‹¤ í˜ì´ì§€ ë Œë”ë§ ì„±ëŠ¥

```bash
curl -o /dev/null -w "Total: %{time_total}s\n" \
  "localhost:9010/waiting-room?user_id=100&queue=default"
```

**ê²°ê³¼**:
```
ì²« ë¡œë”©:      150ms
ë‘ ë²ˆì§¸ ë¡œë”©:  45ms (Thymeleaf ìºì‹±)
í‰ê· :         60ms
```

---

## ğŸš€ ì„±ëŠ¥ ìµœì í™” ê³¼ì •

### Before vs After ë¹„êµ

#### ìµœì í™” 1: ë¸”ë¡œí‚¹ â†’ ë…¼ë¸”ë¡œí‚¹

**Before (Spring MVC + Redis Blocking)**:
```java
public Long registerWaitQueue(String queue, Long userId) {
    // ë¸”ë¡œí‚¹ í˜¸ì¶œ (ê° 100ms ì†Œìš”)
    Long rank = redisTemplate.opsForZSet()
        .rank(key, userId.toString());  // 100ms ëŒ€ê¸°
    
    Long size = redisTemplate.opsForZSet()
        .size(key);  // 100ms ëŒ€ê¸°
    
    String history = redisTemplate.opsForList()
        .range(historyKey, 0, 0);  // 100ms ëŒ€ê¸°
    
    return rank;  // ì´ 300ms
}
```

**ì„±ëŠ¥**:
```
í‰ê·  ì‘ë‹µ ì‹œê°„: 320ms
ì²˜ë¦¬ëŸ‰: 10 TPS
ë©”ëª¨ë¦¬: 800MB (200 ìŠ¤ë ˆë“œ Ã— 4MB)
```

**After (Spring WebFlux + Redis Reactive)**:
```java
public Mono<Long> registerWaitQueue(String queue, Long userId) {
    // ë…¼ë¸”ë¡œí‚¹ í˜¸ì¶œ (ë³‘ë ¬ ì‹¤í–‰)
    return Mono.zip(
        reactiveRedisTemplate.opsForZSet().rank(key, userId.toString()),
        reactiveRedisTemplate.opsForZSet().size(key),
        reactiveRedisTemplate.opsForList().range(historyKey, 0, 0)
    ).map(tuple -> tuple.getT1());  // ì´ 100ms (ë³‘ë ¬)
}
```

**ì„±ëŠ¥**:
```
í‰ê·  ì‘ë‹µ ì‹œê°„: 52ms (-84% ê°œì„ !)
ì²˜ë¦¬ëŸ‰: 90 TPS (+800% ê°œì„ !)
ë©”ëª¨ë¦¬: 200MB (-75% ê°œì„ !)
```

---

#### ìµœì í™” 2: KEYS â†’ SCAN

**Before**:
```java
// âŒ ë¸”ë¡œí‚¹ ëª…ë ¹
Set<String> keys = redisTemplate.keys("users:queue:*:wait");
// 100ê°œ í â†’ 50ms ë¸”ë¡œí‚¹ (Redis ì„œë²„ ë©ˆì¶¤)
```

**After**:
```java
// âœ… ë…¼ë¸”ë¡œí‚¹ ì»¤ì„œ ê¸°ë°˜ ìˆœíšŒ
reactiveRedisTemplate.scan(
    ScanOptions.scanOptions()
        .match("users:queue:*:wait")
        .count(10)  // í•œ ë²ˆì— 10ê°œì”©
        .build()
)
// 100ê°œ í â†’ 10ë²ˆ ë‚˜ëˆ ì„œ ì¡°íšŒ (ê° 5ms, ì´ 50ms, ë…¼ë¸”ë¡œí‚¹)
```

**ì„±ëŠ¥ ë¹„êµ**:
```
KEYS:
  - ì‹¤í–‰ ì‹œê°„: 50ms
  - ë¸”ë¡œí‚¹: Yes (ë‹¤ë¥¸ ëª…ë ¹ ëŒ€ê¸°)
  - ë©”ëª¨ë¦¬: í•œ ë²ˆì— ëª¨ë“  í‚¤ ë¡œë“œ

SCAN:
  - ì‹¤í–‰ ì‹œê°„: 50ms (ë™ì¼)
  - ë¸”ë¡œí‚¹: No (ë‹¤ë¥¸ ëª…ë ¹ ì²˜ë¦¬ ê°€ëŠ¥)
  - ë©”ëª¨ë¦¬: ì²­í¬ ë‹¨ìœ„ë¡œ ë¡œë“œ
```

---

#### ìµœì í™” 3: ìˆœì°¨ â†’ ë³‘ë ¬ ì²˜ë¦¬

**Before (ìˆœì°¨ ì²˜ë¦¬)**:
```java
// 3ê°œ íë¥¼ ìˆœì°¨ì ìœ¼ë¡œ ì²˜ë¦¬
for (String queue : List.of("queue1", "queue2", "queue3")) {
    allowUser(queue, 3).block();  // ê° 100ms
}
// ì´ 300ms
```

**After (ë³‘ë ¬ ì²˜ë¦¬)**:
```java
// 3ê°œ íë¥¼ ë³‘ë ¬ë¡œ ì²˜ë¦¬
Flux.fromIterable(List.of("queue1", "queue2", "queue3"))
    .flatMap(queue -> allowUser(queue, 3))  // ë³‘ë ¬ ì‹¤í–‰
    .subscribe();
// ì´ 100ms (3ë°° ë¹ ë¦„)
```

**ì„±ëŠ¥ ë¹„êµ**:
```
í ê°œìˆ˜    ìˆœì°¨ ì²˜ë¦¬    ë³‘ë ¬ ì²˜ë¦¬    ê°œì„ ìœ¨
  3       300ms       100ms       66%
 10      1000ms       100ms       90%
100     10000ms       150ms       98.5%
```

---

#### ìµœì í™” 4: ê²€ì¦ ë¡œì§ ìµœì í™”

**Before (ë§¤ë²ˆ ê²€ì¦)**:
```java
public Mono<Long> registerWaitQueue(String queue, Long userId) {
    return validateQueueName(queue)  // Redis ì¡°íšŒ
        .then(validateUserId(userId))     // Redis ì¡°íšŒ
        .then(checkQueueCapacity(queue))  // Redis ì¡°íšŒ
        .then(addToQueue(queue, userId)); // Redis ì“°ê¸°
}
// ì´ 4ë²ˆ Redis í†µì‹  (400ms)
```

**After (ê²€ì¦ ìµœì†Œí™”)**:
```java
public Mono<Long> registerWaitQueue(String queue, Long userId) {
    // ë¡œì»¬ ê²€ì¦ (Redis í†µì‹  ì—†ìŒ)
    if (queue == null || userId <= 0) {
        return Mono.error(...);
    }
    
    return checkQueueCapacity(queue)  // Redis ì¡°íšŒ 1ë²ˆ
        .then(addToQueue(queue, userId)); // Redis ì“°ê¸°
}
// ì´ 2ë²ˆ Redis í†µì‹  (200ms, 50% ê°ì†Œ)
```

---

## ğŸ” ë³‘ëª© ì§€ì  ë¶„ì„

### 1. Redis ì‘ë‹µ ì‹œê°„

**ì¸¡ì • ë°©ë²•**:
```java
@Slf4j
public Mono<Long> getRank(String queue, Long userId) {
    long start = System.currentTimeMillis();
    
    return reactiveRedisTemplate.opsForZSet()
        .rank(waitKey, userId.toString())
        .doOnSuccess(rank -> {
            long elapsed = System.currentTimeMillis() - start;
            log.debug("Redis ZRANK took {}ms", elapsed);
        });
}
```

**ì¸¡ì • ê²°ê³¼**:
```
í‰ê· : 15ms
ìµœì†Œ: 5ms
ìµœëŒ€: 45ms
95%: 25ms

ë³‘ëª© ì•„ë‹˜ âœ…
```

---

### 2. Thymeleaf í…œí”Œë¦¿ ë Œë”ë§

**ì¸¡ì • ê²°ê³¼**:
```
ì²« ë Œë”ë§: 150ms (í…œí”Œë¦¿ ì»´íŒŒì¼)
ì´í›„: 10ms (ìºì‹œë¨)

í•´ê²°ì±…: í”„ë¡œë•ì…˜ í™˜ê²½ì—ì„œ ìºì‹œ í™œì„±í™”
```

```yaml
# application.yml
spring:
  thymeleaf:
    cache: true  # í”„ë¡œë•ì…˜ì—ì„œ true
```

---

### 3. ë¡œê¹… ì˜¤ë²„í—¤ë“œ

**Before (ê³¼ë„í•œ ë¡œê¹…)**:
```java
log.debug("Registering user {} to queue {}", userId, queue);
log.debug("Current queue size: {}", size);
log.debug("User rank: {}", rank);
log.debug("Saving history...");
log.debug("Sending notification...");
```

**ì¸¡ì •**: ë¡œê¹…ìœ¼ë¡œ ì¸í•œ ì˜¤ë²„í—¤ë“œ ì•½ 10ms

**After (í•„ìš”í•œ ë¡œê·¸ë§Œ)**:
```java
log.debug("User {} registered to queue {} with rank {}", userId, queue, rank);
```

**ê°œì„ **: ë¡œê¹… ì˜¤ë²„í—¤ë“œ 3msë¡œ ê°ì†Œ

---

## ğŸ“ˆ í™•ì¥ì„± í…ŒìŠ¤íŠ¸

### ìˆ˜ì§ í™•ì¥ (Vertical Scaling)

**í…ŒìŠ¤íŠ¸**: ëŒ€ê¸°ì—´ í¬ê¸°ì— ë”°ë¥¸ ì„±ëŠ¥

```bash
# ëŒ€ê¸°ì—´ í¬ê¸°ë³„ ìˆœìœ„ ì¡°íšŒ ì„±ëŠ¥
for size in 100 1000 10000 100000; do
  # $sizeëª… ë“±ë¡
  # ìˆœìœ„ ì¡°íšŒ 100íšŒ ì¸¡ì •
done
```

**ê²°ê³¼**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ëŒ€ê¸°ì—´ í¬ê¸°    â”‚ í‰ê·  ì‘ë‹µ ì‹œê°„ â”‚ ë©”ëª¨ë¦¬   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚      100      â”‚     18ms      â”‚   5MB    â”‚
â”‚    1,000      â”‚     25ms      â”‚  50MB    â”‚
â”‚   10,000      â”‚     27ms      â”‚ 500MB    â”‚
â”‚  100,000      â”‚     32ms      â”‚   5GB    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ë¶„ì„**:
- O(log N) ë³µì¡ë„ ë•ë¶„ì— í¬ê¸° ì¦ê°€ì—ë„ ì‘ë‹µ ì‹œê°„ ì„ í˜• ì¦ê°€
- 100ë°° ì¦ê°€ â†’ ì‘ë‹µ ì‹œê°„ 2ë°° ì¦ê°€ (ìš°ìˆ˜ âœ…)
- ë©”ëª¨ë¦¬ëŠ” ì„ í˜• ì¦ê°€ (10ë§Œ ëª… â†’ 5GB)

---

### ìˆ˜í‰ í™•ì¥ (Horizontal Scaling)

**í…ŒìŠ¤íŠ¸**: ì• í”Œë¦¬ì¼€ì´ì…˜ ì¸ìŠ¤í„´ìŠ¤ ì¦ê°€

```
ì„¤ì •:
  - Redis: 1ëŒ€ (Standalone)
  - App Server: 1ëŒ€ â†’ 3ëŒ€
  - Load Balancer: Nginx

ë¶€í•˜:
  - ë™ì‹œ ì‚¬ìš©ì: 300ëª…
  - í…ŒìŠ¤íŠ¸ ì‹œê°„: 60ì´ˆ
```

**ê²°ê³¼**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ì¸ìŠ¤í„´ìŠ¤ ìˆ˜  â”‚   ì²˜ë¦¬ëŸ‰     â”‚ í‰ê·  ì‘ë‹µ    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚      1      â”‚   90 TPS     â”‚    52ms      â”‚
â”‚      2      â”‚  175 TPS     â”‚    48ms      â”‚
â”‚      3      â”‚  260 TPS     â”‚    45ms      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ë¶„ì„**:
- ê±°ì˜ ì„ í˜• í™•ì¥ (1ëŒ€ â†’ 3ëŒ€ = 2.9ë°° ì¦ê°€) âœ…
- ë¬´ìƒíƒœ(Stateless) ì„¤ê³„ ë•ë¶„
- Redisê°€ ë³‘ëª©ì´ ë  ë•Œê¹Œì§€ í™•ì¥ ê°€ëŠ¥

---

### Redis ë³‘ëª© ì‹œì 

**í…ŒìŠ¤íŠ¸**: Redis Sentinel/Cluster í•„ìš” ì‹œì 

```bash
# redis-benchmarkë¡œ Redis ìµœëŒ€ ì„±ëŠ¥ ì¸¡ì •
redis-benchmark -h localhost -p 6379 -t zadd -n 100000 -q
```

**ê²°ê³¼**:
```
Redis ë‹¨ì¼ ì¸ìŠ¤í„´ìŠ¤ ìµœëŒ€ ì²˜ë¦¬ëŸ‰:
  - ZADD: ì•½ 50,000 ops/sec
  - ZRANK: ì•½ 80,000 ops/sec

í˜„ì¬ ë¶€í•˜:
  - 90 TPS Ã— 2 (ZADD + ZRANK) = 180 ops/sec

ì—¬ìœ : 50,000 Ã· 180 = ì•½ 277ë°°

ê²°ë¡ : í˜„ì¬ ë¶€í•˜ì—ì„œ RedisëŠ” ë³‘ëª© ì•„ë‹˜ âœ…
```

**Redis ë³‘ëª© ì˜ˆìƒ ì‹œì **:
```
ì• í”Œë¦¬ì¼€ì´ì…˜ ì²˜ë¦¬ëŸ‰ > 20,000 TPS
  â†’ Redis Cluster ê³ ë ¤
```

---

## ğŸ’¡ ê¶Œì¥ ì‚¬í•­

### í”„ë¡œë•ì…˜ ë°°í¬ ì‹œ

#### 1. ë¦¬ì†ŒìŠ¤ ì„¤ì •

```yaml
# application.yml
spring:
  data:
    redis:
      lettuce:
        pool:
          max-active: 20    # ì—°ê²° í’€ í¬ê¸°
          max-idle: 10
          min-idle: 5
          max-wait: 3000ms  # ì—°ê²° ëŒ€ê¸° ì‹œê°„

server:
  netty:
    max-initial-line-length: 4096
    max-header-size: 8192
```

#### 2. JVM ì„¤ì •

```bash
java -Xms512m -Xmx2g \
     -XX:+UseG1GC \
     -XX:MaxGCPauseMillis=200 \
     -jar flow.jar
```

#### 3. Redis ì„¤ì •

```conf
# redis.conf
maxmemory 4gb
maxmemory-policy allkeys-lru

# ì˜ì†ì„±
save 900 1
save 300 10
save 60 10000
appendonly yes
appendfsync everysec

# ì„±ëŠ¥
tcp-backlog 511
timeout 300
tcp-keepalive 300
```

---

### ëª¨ë‹ˆí„°ë§ ì§€í‘œ

#### ì• í”Œë¦¬ì¼€ì´ì…˜ ë©”íŠ¸ë¦­

```yaml
ìˆ˜ì§‘í•  ì§€í‘œ:
  - í‰ê· /ìµœëŒ€/P95 ì‘ë‹µ ì‹œê°„
  - TPS (Transactions Per Second)
  - ì—ëŸ¬ìœ¨
  - JVM í™ ë©”ëª¨ë¦¬
  - GC ë¹ˆë„ ë° ì‹œê°„
```

#### Redis ë©”íŠ¸ë¦­

```bash
# Redis ëª¨ë‹ˆí„°ë§ ëª…ë ¹
redis-cli INFO stats
redis-cli INFO memory
redis-cli INFO clients
redis-cli SLOWLOG GET 10
```

```yaml
ìˆ˜ì§‘í•  ì§€í‘œ:
  - ëª…ë ¹ ì²˜ë¦¬ ìˆ˜ (ops/sec)
  - ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰
  - ì—°ê²°ëœ í´ë¼ì´ì–¸íŠ¸ ìˆ˜
  - ëŠë¦° ì¿¼ë¦¬ (>10ms)
```

---

### ì•ŒëŒ ê¸°ì¤€

```yaml
ê²½ê³  (Warning):
  - í‰ê·  ì‘ë‹µ ì‹œê°„ > 100ms
  - TPS < 50 (ì •ìƒì˜ 50%)
  - ì—ëŸ¬ìœ¨ > 1%
  - Redis ë©”ëª¨ë¦¬ > 80%

ì‹¬ê° (Critical):
  - í‰ê·  ì‘ë‹µ ì‹œê°„ > 500ms
  - TPS < 30 (ì •ìƒì˜ 30%)
  - ì—ëŸ¬ìœ¨ > 5%
  - Redis ë©”ëª¨ë¦¬ > 95%
  - Redis ì—°ê²° ì‹¤íŒ¨
```

---

## ğŸ“Š ì„±ëŠ¥ ê°œì„  ë¡œë“œë§µ

### Phase 1 (ì™„ë£Œ âœ…)
- [x] Spring WebFlux ì ìš©
- [x] Redis Reactive í´ë¼ì´ì–¸íŠ¸
- [x] ë³‘ë ¬ ì²˜ë¦¬ (flatMap)
- [x] SCAN ì‚¬ìš©

### Phase 2 (3ê°œì›”)
- [ ] Redis Connection Pool ìµœì í™”
- [ ] SSE ê¸°ë°˜ ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸
- [ ] Grafana ëŒ€ì‹œë³´ë“œ êµ¬ì¶•
- [ ] ë¶€í•˜ í…ŒìŠ¤íŠ¸ ìë™í™” (CI/CD)

### Phase 3 (6ê°œì›”)
- [ ] Redis Cluster ë„ì…
- [ ] CDN ì ìš© (ì •ì  ë¦¬ì†ŒìŠ¤)
- [ ] WebFlux Netty íŠœë‹
- [ ] Virtual Thread ë„ì… (Java 21)

---

## ğŸ¯ ì„±ëŠ¥ ëª©í‘œ

### í˜„ì¬ ì„±ëŠ¥

```
âœ… í‰ê·  ì‘ë‹µ ì‹œê°„: 52ms (ëª©í‘œ: <100ms)
âœ… ì²˜ë¦¬ëŸ‰: 90 TPS (ëª©í‘œ: >50 TPS)
âœ… ì„±ê³µë¥ : 100% (ëª©í‘œ: >99%)
âœ… P95 ì‘ë‹µ ì‹œê°„: 150ms (ëª©í‘œ: <200ms)
âœ… ë©”ëª¨ë¦¬ ì‚¬ìš©: 200MB (ëª©í‘œ: <500MB)
```

### ìµœì¢… ëª©í‘œ (1ë…„ í›„)

```
ëª©í‘œ:
  - í‰ê·  ì‘ë‹µ ì‹œê°„: <50ms
  - ì²˜ë¦¬ëŸ‰: >1,000 TPS
  - ì„±ê³µë¥ : >99.9%
  - P99 ì‘ë‹µ ì‹œê°„: <200ms
  - ë™ì‹œ ì ‘ì†ì: >10,000ëª…
```

---

## ğŸ”¬ ì¶”ê°€ í…ŒìŠ¤íŠ¸

### ìŠ¤íŠ¸ë ˆìŠ¤ í…ŒìŠ¤íŠ¸

```bash
# ì ì§„ì  ë¶€í•˜ ì¦ê°€
./scripts/stress-test.sh
```

**ê²°ê³¼**:
```
10ëª…:   100% ì„±ê³µ, í‰ê·  45ms
50ëª…:   100% ì„±ê³µ, í‰ê·  52ms
100ëª…:  100% ì„±ê³µ, í‰ê·  68ms
200ëª…:  98% ì„±ê³µ, í‰ê·  95ms
500ëª…:  85% ì„±ê³µ, í‰ê·  250ms  â† í•œê³„ì 
```

**ë¶„ì„**:
- 200ëª…ê¹Œì§€ëŠ” ì•ˆì •ì 
- 500ëª…ì—ì„œ íƒ€ì„ì•„ì›ƒ ë°œìƒ (ì—°ê²° í’€ ë¶€ì¡±)

**í•´ê²°ì±…**:
```yaml
spring:
  data:
    redis:
      lettuce:
        pool:
          max-active: 50  # 20 â†’ 50
```

---

### VIP ìš°ì„ ìˆœìœ„ ê²€ì¦

```bash
./scripts/vip-test.sh
```

**ì‹œë‚˜ë¦¬ì˜¤**:
1. ì¼ë°˜ ì‚¬ìš©ì 10ëª… ë“±ë¡
2. VIP ì‚¬ìš©ì 5ëª… ë“±ë¡
3. 5ëª… ì§„ì… í—ˆìš©

**ê²°ê³¼**:
```
âœ… VIP 5ëª… ëª¨ë‘ ìš°ì„  ì§„ì…
âœ… ì¼ë°˜ ì‚¬ìš©ìëŠ” ëŒ€ê¸° ì¤‘
âœ… ìˆœìœ„ ì •í™•ì„±: 100%
```

---

<div align="center">

ğŸ“ [READMEë¡œ ëŒì•„ê°€ê¸°](../README.md) | ğŸ“‹ [í¬íŠ¸í´ë¦¬ì˜¤](./PORTFOLIO.md) | ğŸ›ï¸ [ì•„í‚¤í…ì²˜](./ARCHITECTURE.md)

**ì„±ëŠ¥ ìµœì í™”ëŠ” ì§€ì†ì ì¸ ëª¨ë‹ˆí„°ë§ê³¼ ê°œì„ ì´ í•„ìš”í•©ë‹ˆë‹¤.**

</div>

